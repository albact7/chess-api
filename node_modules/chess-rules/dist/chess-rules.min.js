!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).chessRules=n()}}(function(){return function n(e,t,r){function o(u,a){if(!t[u]){if(!e[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var l=t[u]={exports:{}};e[u][0].call(l.exports,function(n){var t=e[u][1][n];return o(t||n)},l,l.exports,n,e,t,r)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,e,t){function r(n){var e=function n(){return o.apply(n,arguments)};return e._styles=n,e.__proto__=p,e}function o(){var n=arguments,e=n.length,t=0!==e&&String(arguments[0]);if(e>1)for(var r=1;r<e;r++)t+=" "+n[r];if(!u.enabled||!t)return t;for(var o=this._styles,i=o.length;i--;){var c=a[o[i]];t=c.open+t.replace(c.closeRe,c.open)+c.close}return t}function i(n){for(var e in n)!function(e){u[e]=function(t){if("object"==typeof n[e]){var r=t;for(var o in n[e])r=u[n[e][o]](r);return r}return u[n[e]](t)}}(e)}var u={};e.exports=u,u.themes={};var a=u.styles=n("./styles"),c=Object.defineProperties;u.supportsColor=n("./system/supports-colors"),void 0===u.enabled&&(u.enabled=u.supportsColor),u.stripColors=u.strip=function(n){return(""+n).replace(/\x1B\[\d+m/g,"")};u.stylize=function(n,e){return u.enabled?a[e].open+n+a[e].close:n+""};var s=/[|\\{}()[\]^$+*?.]/g,l=function(n){if("string"!=typeof n)throw new TypeError("Expected a string");return n.replace(s,"\\$&")},f=function(){var n={};return a.grey=a.gray,Object.keys(a).forEach(function(e){a[e].closeRe=new RegExp(l(a[e].close),"g"),n[e]={get:function(){return r(this._styles.concat(e))}}}),n}(),p=c(function(){},f);u.setTheme=function(e){if("string"==typeof e)try{return u.themes[e]=n(e),i(u.themes[e]),u.themes[e]}catch(n){return console.log(n),n}else i(e)};var h=function(n,e){var t=e.split("");return(t=t.map(n)).join("")};u.trap=n("./custom/trap"),u.zalgo=n("./custom/zalgo"),u.maps={},u.maps.america=n("./maps/america"),u.maps.zebra=n("./maps/zebra"),u.maps.rainbow=n("./maps/rainbow"),u.maps.random=n("./maps/random");for(var d in u.maps)!function(n){u[n]=function(e){return h(u.maps[n],e)}}(d);c(u,function(){var n={};return Object.keys(f).forEach(function(e){n[e]={get:function(){return r([e])}}}),n}())},{"./custom/trap":2,"./custom/zalgo":3,"./maps/america":6,"./maps/rainbow":7,"./maps/random":8,"./maps/zebra":9,"./styles":10,"./system/supports-colors":11}],2:[function(n,e,t){e.exports=function(n,e){var t="",r={a:["@","Ä„","Èº","É…","Î”","Î›","Ð”"],b:["ÃŸ","Æ","Éƒ","É®","Î²","à¸¿"],c:["Â©","È»","Ï¾"],d:["Ã","ÆŠ","Ô€","Ô","Ô‚","Ôƒ"],e:["Ã‹","Ä•","ÆŽ","É˜","Î£","Î¾","Ò¼","à©¬"],f:["Óº"],g:["É¢"],h:["Ä¦","Æ•","Ò¢","Òº","Ó‡","ÔŠ"],i:["à¼"],j:["Ä´"],k:["Ä¸","Ò ","Óƒ","Ôž"],l:["Ä¹"],m:["Ê","Ó","ÓŽ","Ô ","Ô¡","àµ©"],n:["Ã‘","Å‹","Æ","Í¶","Î ","ÒŠ"],o:["Ã˜","Ãµ","Ã¸","Ç¾","Ê˜","Ñº","×","Û","à¹"],p:["Ç·","ÒŽ"],q:["à§"],r:["Â®","Æ¦","È","ÉŒ","Ê€","Ð¯"],s:["Â§","Ïž","ÏŸ","Ï¨"],t:["Å","Å¦","Í³"],u:["Æ±","Õ"],v:["×˜"],w:["Ð¨","Ñ ","Ñ¼","àµ°"],x:["Ò²","Ó¾","Ó¼","Ó½"],y:["Â¥","Ò°","Ó‹"],z:["Æµ","É€"]};return(n=(n=n||"Run the trap, drop the bass").split("")).forEach(function(n){n=n.toLowerCase();var e=r[n]||[" "],o=Math.floor(Math.random()*e.length);t+=void 0!==r[n]?r[n][o]:n}),t}},{}],3:[function(n,e,t){e.exports=function(n,e){function t(n){return Math.floor(Math.random()*n)}function r(n){var e=!1;return i.filter(function(t){e=t===n}),e}n=n||"   he is here   ";var o={up:["Ì","ÌŽ","Ì„","Ì…","Ì¿","Ì‘","Ì†","Ì","Í’","Í—","Í‘","Ì‡","Ìˆ","ÌŠ","Í‚","Ì“","Ìˆ","ÍŠ","Í‹","ÍŒ","Ìƒ","Ì‚","ÌŒ","Í","Ì€","Ì","Ì‹","Ì","Ì’","Ì“","Ì”","Ì½","Ì‰","Í£","Í¤","Í¥","Í¦","Í§","Í¨","Í©","Íª","Í«","Í¬","Í­","Í®","Í¯","Ì¾","Í›","Í†","Ìš"],down:["Ì–","Ì—","Ì˜","Ì™","Ìœ","Ì","Ìž","ÌŸ","Ì ","Ì¤","Ì¥","Ì¦","Ì©","Ìª","Ì«","Ì¬","Ì­","Ì®","Ì¯","Ì°","Ì±","Ì²","Ì³","Ì¹","Ìº","Ì»","Ì¼","Í…","Í‡","Íˆ","Í‰","Í","ÍŽ","Í“","Í”","Í•","Í–","Í™","Íš","Ì£"],mid:["Ì•","Ì›","Ì€","Ì","Í˜","Ì¡","Ì¢","Ì§","Ì¨","Ì´","Ìµ","Ì¶","Íœ","Í","Íž","ÍŸ","Í ","Í¢","Ì¸","Ì·","Í¡"," Ò‰"]},i=[].concat(o.up,o.down,o.mid);return function(n,e){var i,u,a="";(e=e||{}).up=void 0===e.up||e.up,e.mid=void 0===e.mid||e.mid,e.down=void 0===e.down||e.down,e.size=void 0!==e.size?e.size:"maxi",n=n.split("");for(u in n)if(!r(u)){switch(a+=n[u],i={up:0,down:0,mid:0},e.size){case"mini":i.up=t(8),i.mid=t(2),i.down=t(8);break;case"maxi":i.up=t(16)+3,i.mid=t(4)+1,i.down=t(64)+3;break;default:i.up=t(8)+1,i.mid=t(6)/2,i.down=t(8)+1}var c=["up","mid","down"];for(var s in c)for(var l=c[s],f=0;f<=i[l];f++)e[l]&&(a+=o[l][t(o[l].length)])}return a}(n,e)}},{}],4:[function(n,e,t){var r=n("./colors");e.exports=function(){function e(n){var e=["__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","charAt","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","charCodeAt","indexOf","lastIndexof","length","localeCompare","match","replace","search","slice","split","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimLeft","trimRight"];Object.keys(n).forEach(function(o){-1!==e.indexOf(o)?console.log("warn: ".red+("String.prototype"+o).magenta+" is probably something you don't want to override. Ignoring style name"):"string"==typeof n[o]?(r[o]=r[n[o]],t(o,function(){return r[n[o]](this)})):t(o,function(){for(var e=this,t=0;t<n[o].length;t++)e=r[n[o][t]](e);return e})})}var t=function(n,e){String.prototype.__defineGetter__(n,e)};t("strip",function(){return r.strip(this)}),t("stripColors",function(){return r.strip(this)}),t("trap",function(){return r.trap(this)}),t("zalgo",function(){return r.zalgo(this)}),t("zebra",function(){return r.zebra(this)}),t("rainbow",function(){return r.rainbow(this)}),t("random",function(){return r.random(this)}),t("america",function(){return r.america(this)}),Object.keys(r.styles).forEach(function(n){t(n,function(){return r.stylize(this,n)})}),r.setTheme=function(t){if("string"==typeof t)try{return r.themes[t]=n(t),e(r.themes[t]),r.themes[t]}catch(n){return console.log(n),n}else e(t)}}},{"./colors":1}],5:[function(n,e,t){var r=n("./colors");e.exports=r,n("./extendStringPrototype")()},{"./colors":1,"./extendStringPrototype":4}],6:[function(n,e,t){var r=n("../colors");e.exports=function(n,e,t){if(" "===n)return n;switch(e%3){case 0:return r.red(n);case 1:return r.white(n);case 2:return r.blue(n)}}},{"../colors":1}],7:[function(n,e,t){var r=n("../colors");e.exports=function(){var n=["red","yellow","green","blue","magenta"];return function(e,t,o){return" "===e?e:r[n[t++%n.length]](e)}}()},{"../colors":1}],8:[function(n,e,t){var r=n("../colors");e.exports=function(){var n=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta"];return function(e,t,o){return" "===e?e:r[n[Math.round(Math.random()*(n.length-1))]](e)}}()},{"../colors":1}],9:[function(n,e,t){var r=n("../colors");e.exports=function(n,e,t){return e%2==0?n:r.inverse(n)}},{"../colors":1}],10:[function(n,e,t){var r={};e.exports=r;var o={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(o).forEach(function(n){var e=o[n],t=r[n]=[];t.open="["+e[0]+"m",t.close="["+e[1]+"m"})},{}],11:[function(n,e,t){(function(n){var t=n.argv;e.exports=-1===t.indexOf("--no-color")&&-1===t.indexOf("--color=false")&&(-1!==t.indexOf("--color")||-1!==t.indexOf("--color=true")||-1!==t.indexOf("--color=always")||!(n.stdout&&!n.stdout.isTTY)&&("win32"===n.platform||("COLORTERM"in n.env||"dumb"!==n.env.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.env.TERM))))}).call(this,n("_process"))},{_process:12}],12:[function(n,e,t){function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(n){if(f===setTimeout)return setTimeout(n,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(n,0);try{return f(n,0)}catch(e){try{return f.call(null,n,0)}catch(e){return f.call(this,n,0)}}}function u(n){if(p===clearTimeout)return clearTimeout(n);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(n);try{return p(n)}catch(e){try{return p.call(null,n)}catch(e){return p.call(this,n)}}}function a(){y&&d&&(y=!1,d.length?v=d.concat(v):g=-1,v.length&&c())}function c(){if(!y){var n=i(a);y=!0;for(var e=v.length;e;){for(d=v,v=[];++g<e;)d&&d[g].run();g=-1,e=v.length}d=null,y=!1,u(n)}}function s(n,e){this.fun=n,this.array=e}function l(){}var f,p,h=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(n){f=r}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(n){p=o}}();var d,v=[],y=!1,g=-1;h.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];v.push(new s(n,e)),1!==v.length||y||i(c)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(n){return[]},h.binding=function(n){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(n){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],13:[function(n,e,t){(function(t){(function(){var r,o,i,u,a,c,s,l,f=[].slice;l=n("underscore"),i={cmd:"âŒ˜",ctrl:"âŒƒ",alt:"âŒ¥",option:"âŒ¥",shift:"â‡§",enter:"âŽ",left:"â†",right:"â†’",up:"â†‘",down:"â†“"},u={cmd:"Cmd",ctrl:"Ctrl",alt:"Alt",option:"Alt",shift:"Shift",enter:"Enter",left:"Left",right:"Right",up:"Up",down:"Down"},c={"~":"`",_:"-","+":"=","|":"\\","{":"[","}":"]",":":";",'"':"'","<":",",">":".","?":"/"},s=function(n){var e,t,r,o,i;if(r=0,t=[],null==n)return t;for(e=o=0,i=n.length;o<i;e=++o)"."!==n[e]||0!==e&&"\\"===n[e-1]||(t.push(n.substring(r,e)),r=e+1);return t.push(n.substr(r,n.length)),t},o=function(n){return l.isObject(n)&&!l.isArray(n)},a={adviseBefore:function(n,e,t){var r;return r=n[e],n[e]=function(){var n;if(n=1<=arguments.length?f.call(arguments,0):[],!1!==t.apply(this,n))return r.apply(this,n)}},camelize:function(n){return n?n.replace(/[_-]+(\w)/g,function(n){return n[1].toUpperCase()}):""},capitalize:function(n){return n?"github"===n.toLowerCase()?"GitHub":n[0].toUpperCase()+n.slice(1):""},compactObject:function(n){var e,t,r;t={};for(e in n)null!=(r=n[e])&&(t[e]=r);return t},dasherize:function(n){return n?(n=n[0].toLowerCase()+n.slice(1)).replace(/([A-Z])|(_)/g,function(n,e){return e?"-"+e.toLowerCase():"-"}):""},deepClone:function(n){return l.isArray(n)?n.map(function(n){return a.deepClone(n)}):l.isObject(n)&&!l.isFunction(n)?a.mapObject(n,function(n,e){return[n,a.deepClone(e)]}):n},deepExtend:function(n){var e,t,r,i,u,c,s;for(i=n,e=0;++e<arguments.length;)if(r=arguments[e],o(i)&&o(r))for(u=0,c=(s=Object.keys(r)).length;u<c;u++)i[t=s[u]]=a.deepExtend(i[t],r[t]);else i=a.deepClone(r);return i},deepContains:function(n,e){var t,r,o;if(null==n)return!1;for(r=0,o=n.length;r<o;r++)if(t=n[r],l.isEqual(t,e))return!0;return!1},endsWith:function(n,e){return null==e&&(e=""),!!n&&-1!==n.indexOf(e,n.length-e.length)},escapeAttribute:function(n){return n?n.replace(/"/g,"&quot;").replace(/\n/g,"").replace(/\\/g,"-"):""},escapeRegExp:function(n){return n?n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"):""},humanizeEventName:function(n,e){var t,r,o,i;return i=n.split(":"),r=i[0],null==(t=i[1])?a.undasherize(r):(o=a.undasherize(r),null==e&&(e=a.undasherize(t)),o+": "+e)},humanizeKey:function(n,e){var r;return null==e&&(e=t.platform),n?(r="darwin"===e?i:u)[n]?r[n]:1===n.length&&null!=c[n]?[r.shift,c[n]]:1===n.length&&n===n.toUpperCase()&&n.toUpperCase()!==n.toLowerCase()?[r.shift,n.toUpperCase()]:1===n.length||/f[0-9]{1,2}/.test(n)?n.toUpperCase():"darwin"===e?n:a.capitalize(n):n},humanizeKeystroke:function(n,e){var r,o,i,u,c,s,f,p,h,d;if(null==e&&(e=t.platform),!n)return n;for(r=[],f=0,h=(c=n.split(" ")).length;f<h;f++){for(u=[],o=p=0,d=(s=(n=c[f]).split("-")).length;p<d;o=++p)""===(i=s[o])&&""===s[o-1]&&(i="-"),i&&u.push(a.humanizeKey(i,e));u=l.uniq(l.flatten(u)),u="darwin"===e?u.join(""):u.join("+"),r.push(u)}return r.join(" ")},isSubset:function(n,e){return l.every(n,function(n){return l.include(e,n)})},losslessInvert:function(n){var e,t,r;e={};for(t in n)null==e[r=n[t]]&&(e[r]=[]),e[r].push(t);return e},mapObject:function(n,e){var t,r,o,i,u,a,c;for(r={},i=0,u=(a=Object.keys(n)).length;i<u;i++)t=(c=e(t=a[i],n[t]))[0],o=c[1],r[t]=o;return r},multiplyString:function(n,e){var t,r;for(t="",r=0;r<e;)t+=n,r++;return t},pluralize:function(n,e,t){return null==n&&(n=0),null==t&&(t=e+"s"),1===n?n+" "+e:n+" "+t},remove:function(n,e){var t;return(t=n.indexOf(e))>=0&&n.splice(t,1),n},setValueForKeyPath:function(n,e,t){var r,o;for(o=s(e);o.length>1;)null==n[r=o.shift()]&&(n[r]={}),n=n[r];return null!=t?n[o.shift()]=t:delete n[o.shift()]},hasKeyPath:function(n,e){var t,r,o,i;for(o=0,i=(r=s(e)).length;o<i;o++){if(t=r[o],!n.hasOwnProperty(t))return!1;n=n[t]}return!0},spliceWithArray:function(n,e,t,r,o){var i,u,a,c;if(null==o&&(o=1e5),r.length<o)return n.splice.apply(n,[e,t].concat(f.call(r)));for(n.splice(e,t),c=[],i=u=0,a=r.length;o>0?u<=a:u>=a;i=u+=o)c.push(n.splice.apply(n,[e+i,0].concat(f.call(r.slice(i,i+o)))));return c},sum:function(n){var e,t,r;for(e=0,t=0,r=n.length;t<r;t++)e+=n[t];return e},uncamelcase:function(n){var e;return n?(e=n.replace(/([A-Z])|_+/g,function(n,e){return null==e&&(e="")," "+e}),a.capitalize(e.trim())):""},undasherize:function(n){return n?n.split("-").map(a.capitalize).join(" "):""},underscore:function(n){return n?(n=n[0].toLowerCase()+n.slice(1)).replace(/([A-Z])|-+/g,function(n,e){return null==e&&(e=""),"_"+e.toLowerCase()}):""},valueForKeyPath:function(n,e){var t,r,o,i;for(o=0,i=(r=s(e)).length;o<i;o++)if(t=r[o],null==(n=n[t]))return;return n},isEqual:function(n,e,t,o){return l.isArray(t)&&l.isArray(o)?r(n,e,t,o):r(n,e)},isEqualForProperties:function(){var n,e,t,r,o,i;for(n=arguments[0],e=arguments[1],o=0,i=(t=3<=arguments.length?f.call(arguments,2):[]).length;o<i;o++)if(r=t[o],!l.isEqual(n[r],e[r]))return!1;return!0}},r=function(n,e,t,o){var i,u,a,c,s,f,p,h,d,v,y,g,m,b;if(null==t&&(t=[]),null==o&&(o=[]),n===e)return l.isEqual(n,e);if(l.isFunction(n)||l.isFunction(e))return l.isEqual(n,e);for(g=t.length;g--;)if(t[g]===n)return o[g]===e;if(t.push(n),o.push(e),d=!1,l.isFunction(null!=n?n.isEqual:void 0))d=n.isEqual(e,t,o);else if(l.isFunction(null!=e?e.isEqual:void 0))d=e.isEqual(n,o,t);else if(l.isArray(n)&&l.isArray(e)&&n.length===e.length){for(d=!0,v=m=0,b=n.length;m<b;v=++m)if(a=n[v],!r(a,e[v],t,o)){d=!1;break}}else if(l.isRegExp(n)&&l.isRegExp(e))d=l.isEqual(n,e);else if(l.isElement(n)&&l.isElement(e))d=n===e;else if(l.isObject(n)&&l.isObject(e))if(i=n.constructor,f=e.constructor,u=l.isFunction(i)&&i instanceof i,p=l.isFunction(f)&&f instanceof f,i===f||u&&p){c=0,d=!0;for(y in n)if(s=n[y],l.has(n,y)&&(c++,!l.has(e,y)||!r(s,e[y],t,o))){d=!1;break}if(d){h=0;for(y in e)e[y],l.has(e,y)&&h++;d=c===h}}else d=!1;else d=l.isEqual(n,e);return t.pop(),o.pop(),d},e.exports=l.extend({},l,a)}).call(this)}).call(this,n("_process"))},{_process:12,underscore:14}],14:[function(n,e,t){(function(){var n=this,r=n._,o={},i=Array.prototype,u=Object.prototype,a=Function.prototype,c=i.push,s=i.slice,l=i.concat,f=u.toString,p=u.hasOwnProperty,h=i.forEach,d=i.map,v=i.reduce,y=i.reduceRight,g=i.filter,m=i.every,b=i.some,w=i.indexOf,x=i.lastIndexOf,C=Array.isArray,F=Object.keys,E=a.bind,B=function(n){return n instanceof B?n:this instanceof B?void(this._wrapped=n):new B(n)};void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=B),t._=B):n._=B,B.VERSION="1.6.0";var _=B.each=B.forEach=function(n,e,t){if(null==n)return n;if(h&&n.forEach===h)n.forEach(e,t);else if(n.length===+n.length){for(var r=0,i=n.length;r<i;r++)if(e.call(t,n[r],r,n)===o)return}else for(var u=B.keys(n),r=0,i=u.length;r<i;r++)if(e.call(t,n[u[r]],u[r],n)===o)return;return n};B.map=B.collect=function(n,e,t){var r=[];return null==n?r:d&&n.map===d?n.map(e,t):(_(n,function(n,o,i){r.push(e.call(t,n,o,i))}),r)};var M="Reduce of empty array with no initial value";B.reduce=B.foldl=B.inject=function(n,e,t,r){var o=arguments.length>2;if(null==n&&(n=[]),v&&n.reduce===v)return r&&(e=B.bind(e,r)),o?n.reduce(e,t):n.reduce(e);if(_(n,function(n,i,u){o?t=e.call(r,t,n,i,u):(t=n,o=!0)}),!o)throw new TypeError(M);return t},B.reduceRight=B.foldr=function(n,e,t,r){var o=arguments.length>2;if(null==n&&(n=[]),y&&n.reduceRight===y)return r&&(e=B.bind(e,r)),o?n.reduceRight(e,t):n.reduceRight(e);var i=n.length;if(i!==+i){var u=B.keys(n);i=u.length}if(_(n,function(a,c,s){c=u?u[--i]:--i,o?t=e.call(r,t,n[c],c,s):(t=n[c],o=!0)}),!o)throw new TypeError(M);return t},B.find=B.detect=function(n,e,t){var r;return O(n,function(n,o,i){if(e.call(t,n,o,i))return r=n,!0}),r},B.filter=B.select=function(n,e,t){var r=[];return null==n?r:g&&n.filter===g?n.filter(e,t):(_(n,function(n,o,i){e.call(t,n,o,i)&&r.push(n)}),r)},B.reject=function(n,e,t){return B.filter(n,function(n,r,o){return!e.call(t,n,r,o)},t)},B.every=B.all=function(n,e,t){e||(e=B.identity);var r=!0;return null==n?r:m&&n.every===m?n.every(e,t):(_(n,function(n,i,u){if(!(r=r&&e.call(t,n,i,u)))return o}),!!r)};var O=B.some=B.any=function(n,e,t){e||(e=B.identity);var r=!1;return null==n?r:b&&n.some===b?n.some(e,t):(_(n,function(n,i,u){if(r||(r=e.call(t,n,i,u)))return o}),!!r)};B.contains=B.include=function(n,e){return null!=n&&(w&&n.indexOf===w?-1!=n.indexOf(e):O(n,function(n){return n===e}))},B.invoke=function(n,e){var t=s.call(arguments,2),r=B.isFunction(e);return B.map(n,function(n){return(r?e:n[e]).apply(n,t)})},B.pluck=function(n,e){return B.map(n,B.property(e))},B.where=function(n,e){return B.filter(n,B.matches(e))},B.findWhere=function(n,e){return B.find(n,B.matches(e))},B.max=function(n,e,t){if(!e&&B.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);var r=-1/0,o=-1/0;return _(n,function(n,i,u){var a=e?e.call(t,n,i,u):n;a>o&&(r=n,o=a)}),r},B.min=function(n,e,t){if(!e&&B.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);var r=1/0,o=1/0;return _(n,function(n,i,u){var a=e?e.call(t,n,i,u):n;a<o&&(r=n,o=a)}),r},B.shuffle=function(n){var e,t=0,r=[];return _(n,function(n){e=B.random(t++),r[t-1]=r[e],r[e]=n}),r},B.sample=function(n,e,t){return null==e||t?(n.length!==+n.length&&(n=B.values(n)),n[B.random(n.length-1)]):B.shuffle(n).slice(0,Math.max(0,e))};var k=function(n){return null==n?B.identity:B.isFunction(n)?n:B.property(n)};B.sortBy=function(n,e,t){return e=k(e),B.pluck(B.map(n,function(n,r,o){return{value:n,index:r,criteria:e.call(t,n,r,o)}}).sort(function(n,e){var t=n.criteria,r=e.criteria;if(t!==r){if(t>r||void 0===t)return 1;if(t<r||void 0===r)return-1}return n.index-e.index}),"value")};var P=function(n){return function(e,t,r){var o={};return t=k(t),_(e,function(i,u){var a=t.call(r,i,u,e);n(o,a,i)}),o}};B.groupBy=P(function(n,e,t){B.has(n,e)?n[e].push(t):n[e]=[t]}),B.indexBy=P(function(n,e,t){n[e]=t}),B.countBy=P(function(n,e){B.has(n,e)?n[e]++:n[e]=1}),B.sortedIndex=function(n,e,t,r){for(var o=(t=k(t)).call(r,e),i=0,u=n.length;i<u;){var a=i+u>>>1;t.call(r,n[a])<o?i=a+1:u=a}return i},B.toArray=function(n){return n?B.isArray(n)?s.call(n):n.length===+n.length?B.map(n,B.identity):B.values(n):[]},B.size=function(n){return null==n?0:n.length===+n.length?n.length:B.keys(n).length},B.first=B.head=B.take=function(n,e,t){if(null!=n)return null==e||t?n[0]:e<0?[]:s.call(n,0,e)},B.initial=function(n,e,t){return s.call(n,0,n.length-(null==e||t?1:e))},B.last=function(n,e,t){if(null!=n)return null==e||t?n[n.length-1]:s.call(n,Math.max(n.length-e,0))},B.rest=B.tail=B.drop=function(n,e,t){return s.call(n,null==e||t?1:e)},B.compact=function(n){return B.filter(n,B.identity)};var T=function(n,e,t){return e&&B.every(n,B.isArray)?l.apply(t,n):(_(n,function(n){B.isArray(n)||B.isArguments(n)?e?c.apply(t,n):T(n,e,t):t.push(n)}),t)};B.flatten=function(n,e){return T(n,e,[])},B.without=function(n){return B.difference(n,s.call(arguments,1))},B.partition=function(n,e){var t=[],r=[];return _(n,function(n){(e(n)?t:r).push(n)}),[t,r]},B.uniq=B.unique=function(n,e,t,r){B.isFunction(e)&&(r=t,t=e,e=!1);var o=t?B.map(n,t,r):n,i=[],u=[];return _(o,function(t,r){(e?r&&u[u.length-1]===t:B.contains(u,t))||(u.push(t),i.push(n[r]))}),i},B.union=function(){return B.uniq(B.flatten(arguments,!0))},B.intersection=function(n){var e=s.call(arguments,1);return B.filter(B.uniq(n),function(n){return B.every(e,function(e){return B.contains(e,n)})})},B.difference=function(n){var e=l.apply(i,s.call(arguments,1));return B.filter(n,function(n){return!B.contains(e,n)})},B.zip=function(){for(var n=B.max(B.pluck(arguments,"length").concat(0)),e=new Array(n),t=0;t<n;t++)e[t]=B.pluck(arguments,""+t);return e},B.object=function(n,e){if(null==n)return{};for(var t={},r=0,o=n.length;r<o;r++)e?t[n[r]]=e[r]:t[n[r][0]]=n[r][1];return t},B.indexOf=function(n,e,t){if(null==n)return-1;var r=0,o=n.length;if(t){if("number"!=typeof t)return r=B.sortedIndex(n,e),n[r]===e?r:-1;r=t<0?Math.max(0,o+t):t}if(w&&n.indexOf===w)return n.indexOf(e,t);for(;r<o;r++)if(n[r]===e)return r;return-1},B.lastIndexOf=function(n,e,t){if(null==n)return-1;var r=null!=t;if(x&&n.lastIndexOf===x)return r?n.lastIndexOf(e,t):n.lastIndexOf(e);for(var o=r?t:n.length;o--;)if(n[o]===e)return o;return-1},B.range=function(n,e,t){arguments.length<=1&&(e=n||0,n=0),t=arguments[2]||1;for(var r=Math.max(Math.ceil((e-n)/t),0),o=0,i=new Array(r);o<r;)i[o++]=n,n+=t;return i};var W=function(){};B.bind=function(n,e){var t,r;if(E&&n.bind===E)return E.apply(n,s.call(arguments,1));if(!B.isFunction(n))throw new TypeError;return t=s.call(arguments,2),r=function(){if(!(this instanceof r))return n.apply(e,t.concat(s.call(arguments)));W.prototype=n.prototype;var o=new W;W.prototype=null;var i=n.apply(o,t.concat(s.call(arguments)));return Object(i)===i?i:o}},B.partial=function(n){var e=s.call(arguments,1);return function(){for(var t=0,r=e.slice(),o=0,i=r.length;o<i;o++)r[o]===B&&(r[o]=arguments[t++]);for(;t<arguments.length;)r.push(arguments[t++]);return n.apply(this,r)}},B.bindAll=function(n){var e=s.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return _(e,function(e){n[e]=B.bind(n[e],n)}),n},B.memoize=function(n,e){var t={};return e||(e=B.identity),function(){var r=e.apply(this,arguments);return B.has(t,r)?t[r]:t[r]=n.apply(this,arguments)}},B.delay=function(n,e){var t=s.call(arguments,2);return setTimeout(function(){return n.apply(null,t)},e)},B.defer=function(n){return B.delay.apply(B,[n,1].concat(s.call(arguments,1)))},B.throttle=function(n,e,t){var r,o,i,u=null,a=0;t||(t={});var c=function(){a=!1===t.leading?0:B.now(),u=null,i=n.apply(r,o),r=o=null};return function(){var s=B.now();a||!1!==t.leading||(a=s);var l=e-(s-a);return r=this,o=arguments,l<=0?(clearTimeout(u),u=null,a=s,i=n.apply(r,o),r=o=null):u||!1===t.trailing||(u=setTimeout(c,l)),i}},B.debounce=function(n,e,t){var r,o,i,u,a,c=function(){var s=B.now()-u;s<e?r=setTimeout(c,e-s):(r=null,t||(a=n.apply(i,o),i=o=null))};return function(){i=this,o=arguments,u=B.now();var s=t&&!r;return r||(r=setTimeout(c,e)),s&&(a=n.apply(i,o),i=o=null),a}},B.once=function(n){var e,t=!1;return function(){return t?e:(t=!0,e=n.apply(this,arguments),n=null,e)}},B.wrap=function(n,e){return B.partial(e,n)},B.compose=function(){var n=arguments;return function(){for(var e=arguments,t=n.length-1;t>=0;t--)e=[n[t].apply(this,e)];return e[0]}},B.after=function(n,e){return function(){if(--n<1)return e.apply(this,arguments)}},B.keys=function(n){if(!B.isObject(n))return[];if(F)return F(n);var e=[];for(var t in n)B.has(n,t)&&e.push(t);return e},B.values=function(n){for(var e=B.keys(n),t=e.length,r=new Array(t),o=0;o<t;o++)r[o]=n[e[o]];return r},B.pairs=function(n){for(var e=B.keys(n),t=e.length,r=new Array(t),o=0;o<t;o++)r[o]=[e[o],n[e[o]]];return r},B.invert=function(n){for(var e={},t=B.keys(n),r=0,o=t.length;r<o;r++)e[n[t[r]]]=t[r];return e},B.functions=B.methods=function(n){var e=[];for(var t in n)B.isFunction(n[t])&&e.push(t);return e.sort()},B.extend=function(n){return _(s.call(arguments,1),function(e){if(e)for(var t in e)n[t]=e[t]}),n},B.pick=function(n){var e={},t=l.apply(i,s.call(arguments,1));return _(t,function(t){t in n&&(e[t]=n[t])}),e},B.omit=function(n){var e={},t=l.apply(i,s.call(arguments,1));for(var r in n)B.contains(t,r)||(e[r]=n[r]);return e},B.defaults=function(n){return _(s.call(arguments,1),function(e){if(e)for(var t in e)void 0===n[t]&&(n[t]=e[t])}),n},B.clone=function(n){return B.isObject(n)?B.isArray(n)?n.slice():B.extend({},n):n},B.tap=function(n,e){return e(n),n};var A=function(n,e,t,r){if(n===e)return 0!==n||1/n==1/e;if(null==n||null==e)return n===e;n instanceof B&&(n=n._wrapped),e instanceof B&&(e=e._wrapped);var o=f.call(n);if(o!=f.call(e))return!1;switch(o){case"[object String]":return n==String(e);case"[object Number]":return n!=+n?e!=+e:0==n?1/n==1/e:n==+e;case"[object Date]":case"[object Boolean]":return+n==+e;case"[object RegExp]":return n.source==e.source&&n.global==e.global&&n.multiline==e.multiline&&n.ignoreCase==e.ignoreCase}if("object"!=typeof n||"object"!=typeof e)return!1;for(var i=t.length;i--;)if(t[i]==n)return r[i]==e;var u=n.constructor,a=e.constructor;if(u!==a&&!(B.isFunction(u)&&u instanceof u&&B.isFunction(a)&&a instanceof a)&&"constructor"in n&&"constructor"in e)return!1;t.push(n),r.push(e);var c=0,s=!0;if("[object Array]"==o){if(c=n.length,s=c==e.length)for(;c--&&(s=A(n[c],e[c],t,r)););}else{for(var l in n)if(B.has(n,l)&&(c++,!(s=B.has(e,l)&&A(n[l],e[l],t,r))))break;if(s){for(l in e)if(B.has(e,l)&&!c--)break;s=!c}}return t.pop(),r.pop(),s};B.isEqual=function(n,e){return A(n,e,[],[])},B.isEmpty=function(n){if(null==n)return!0;if(B.isArray(n)||B.isString(n))return 0===n.length;for(var e in n)if(B.has(n,e))return!1;return!0},B.isElement=function(n){return!(!n||1!==n.nodeType)},B.isArray=C||function(n){return"[object Array]"==f.call(n)},B.isObject=function(n){return n===Object(n)},_(["Arguments","Function","String","Number","Date","RegExp"],function(n){B["is"+n]=function(e){return f.call(e)=="[object "+n+"]"}}),B.isArguments(arguments)||(B.isArguments=function(n){return!(!n||!B.has(n,"callee"))}),"function"!=typeof/./&&(B.isFunction=function(n){return"function"==typeof n}),B.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},B.isNaN=function(n){return B.isNumber(n)&&n!=+n},B.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"==f.call(n)},B.isNull=function(n){return null===n},B.isUndefined=function(n){return void 0===n},B.has=function(n,e){return p.call(n,e)},B.noConflict=function(){return n._=r,this},B.identity=function(n){return n},B.constant=function(n){return function(){return n}},B.property=function(n){return function(e){return e[n]}},B.matches=function(n){return function(e){if(e===n)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0}},B.times=function(n,e,t){for(var r=Array(Math.max(0,n)),o=0;o<n;o++)r[o]=e.call(t,o);return r},B.random=function(n,e){return null==e&&(e=n,n=0),n+Math.floor(Math.random()*(e-n+1))},B.now=Date.now||function(){return(new Date).getTime()};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};j.unescape=B.invert(j.escape);var R={escape:new RegExp("["+B.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+B.keys(j.unescape).join("|")+")","g")};B.each(["escape","unescape"],function(n){B[n]=function(e){return null==e?"":(""+e).replace(R[n],function(e){return j[n][e]})}}),B.result=function(n,e){if(null!=n){var t=n[e];return B.isFunction(t)?t.call(n):t}},B.mixin=function(n){_(B.functions(n),function(e){var t=B[e]=n[e];B.prototype[e]=function(){var n=[this._wrapped];return c.apply(n,arguments),q.call(this,t.apply(B,n))}})};var K=0;B.uniqueId=function(n){var e=++K+"";return n?n+e:e},B.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},S=/\\|'|\r|\n|\t|\u2028|\u2029/g;B.template=function(n,e,t){var r;t=B.defaults({},t,B.templateSettings);var o=new RegExp([(t.escape||z).source,(t.interpolate||z).source,(t.evaluate||z).source].join("|")+"|$","g"),i=0,u="__p+='";n.replace(o,function(e,t,r,o,a){return u+=n.slice(i,a).replace(S,function(n){return"\\"+N[n]}),t&&(u+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'"),r&&(u+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(u+="';\n"+o+"\n__p+='"),i=a+e.length,e}),u+="';\n",t.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{r=new Function(t.variable||"obj","_",u)}catch(n){throw n.source=u,n}if(e)return r(e,B);var a=function(n){return r.call(this,n,B)};return a.source="function("+(t.variable||"obj")+"){\n"+u+"}",a},B.chain=function(n){return B(n).chain()};var q=function(n){return this._chain?B(n).chain():n};B.mixin(B),_(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var e=i[n];B.prototype[n]=function(){var t=this._wrapped;return e.apply(t,arguments),"shift"!=n&&"splice"!=n||0!==t.length||delete t[0],q.call(this,t)}}),_(["concat","join","slice"],function(n){var e=i[n];B.prototype[n]=function(){return q.call(this,e.apply(this._wrapped,arguments))}}),B.extend(B.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],15:[function(n,e,t){"use strict";function r(n,e){void 0===e?(this.offset=n,this.x=this.offset%8,this.y=Math.floor(this.offset/8)):(this.offset=n+8*e,this.x=n,this.y=e)}r.prototype.add=function(n){return new r(this.x+n.x,this.y+n.y)},r.prototype.sub=function(n){return new r(this.x-n.x,this.y-n.y)},r.prototype.isValid=function(){return this.x>=0&&this.x<8&&this.y>=0&&this.y<8},e.exports={BoardCoordinates:r}},{}],16:[function(n,e,t){"use strict";var r=n("./position");e.exports={positionToFen:function(n){for(var e="",t=0,r=7;r>=0;r--){for(var o=0;o<8;o++){var i=n.board[8*r+o];if(null==i)t+=1;else{t>0&&(e+=t,t=0);var u=i.type;e+=u="W"==i.side?u.toUpperCase():u.toLowerCase()}}t>0&&(e+=t,t=0),r>0&&(e+="/")}e+=" ",e+=n.turn.toLowerCase(),e+=" ";var a="";return a+=n.castlingFlags.W.K?"K":"",a+=n.castlingFlags.W.Q?"Q":"",a+=n.castlingFlags.B.K?"k":"",a+=n.castlingFlags.B.Q?"q":"",e+=""==a?"-":a,e+=" ",null==n.lastPawnMoveColumn?e+="-":(e+="abcdefgh"[n.lastPawnMoveColumn],e+="W"==n.turn?"6":"3"),e+=" "+n.halfMoveClock,e+=" "+n.fullMoveNumber},fenToPosition:function(n){for(var e=n.replace(/\s+/g," ").split(" "),t=r.getInitialPosition(),o=7,i=0,u=0;void 0!=e[0][u];){var a=e[0][u++],c=Number(a);if("/"==a)8!=i&&console.log("FEN line separator occurred while current column was "+i),i=0,o--;else if(isNaN(c))t.board[8*o+i]={type:a.toUpperCase(),side:a==a.toUpperCase()?"W":"B"},i+=1;else for(;c>0;)t.board[8*o+i]=null,i+=1,c-=1}if("b"==e[1].toLowerCase()&&(t.turn="B"),t.castlingFlags.W.K=-1!=e[2].indexOf("K"),t.castlingFlags.W.Q=-1!=e[2].indexOf("Q"),t.castlingFlags.B.K=-1!=e[2].indexOf("k"),t.castlingFlags.B.Q=-1!=e[2].indexOf("q"),"-"!=e[3]){var s="abcdefgh".indexOf(e[3][0]);t.lastPawnMoveColumn=s}return t.fullMoveNumber=Number(e[5]),t.halfMoveClock=Number(e[4]),t}}},{"./position":23}],17:[function(n,e,t){"use strict";var r=n("./coordinates").BoardCoordinates;e.exports={findPiece:function(n,e,t){for(var o=t||n.turn,i=[],u=0;u<64;u++){var a=n.board[u];null!=a&&a.type===e&&a.side===o&&i.push(u)}var c=[];return i.forEach(function(n){c.push(new r(n))}),c}}},{"./coordinates":15}],18:[function(n,e,t){"use strict";function r(n,e){return e.isValid()&&null==n.board[e.offset]}function o(n,e){if(!e.isValid())return!1;var t=n.board[e.offset];return null!=t&&n.turn!==t.side}function i(n,e){if(!e.isValid())return!1;var t=n.board[e.offset];return null==t||n.turn!==t.side}function u(n,e,t,i){for(var u=e;;){if(!(u=u.add(t)).isValid())break;if(!r(n,u)){o(n,u)&&i.push(u);break}i.push(u)}}var a=n("./coordinates").BoardCoordinates,c=[];c.P=function(n,e){var t="W"==n.turn?1:-1,i="W"==n.turn?1:6,u=e.add(new a(0,t)),c=u.add(new a(0,t)),s=e.add(new a(1,t)),l=e.add(new a(-1,t)),f=[];return r(n,u)&&f.push(u),o(n,l)?f.push(l):n.lastPawnMoveColumn==e.x-1&&(e.y-i)/t==3&&f.push(l),o(n,s)?f.push(s):n.lastPawnMoveColumn==e.x+1&&(e.y-i)/t==3&&f.push(s),e.y==i&&r(n,u)&&r(n,c)&&f.push(c),f},c.N=function(n,e){var t=[];return[e.add(new a(-1,2)),e.add(new a(1,2)),e.add(new a(2,-1)),e.add(new a(2,1)),e.add(new a(1,-2)),e.add(new a(-1,-2)),e.add(new a(-2,1)),e.add(new a(-2,-1))].forEach(function(e){i(n,e)&&t.push(e)}),t},c.B=function(n,e){var t=[];return[new a(-1,-1),new a(-1,1),new a(1,-1),new a(1,1)].forEach(function(r){u(n,e,r,t)}),t},c.R=function(n,e){var t=[];return[new a(-1,0),new a(1,0),new a(0,-1),new a(0,1)].forEach(function(r){u(n,e,r,t)}),t},c.K=function(n,e){for(var t=[],o=-1;o<2;o++)for(var u=-1;u<2;u++)if(0!=o||0!=u){var c=new a(o,u),s=e.add(c);i(n,s)&&t.push(s)}if(n.castlingFlags[n.turn].K){var l=e.add(new a(1,0)),f=e.add(new a(2,0));r(n,l)&&r(n,f)&&t.push(f)}if(n.castlingFlags[n.turn].Q){var l=e.add(new a(-1,0)),f=e.add(new a(-2,0));r(n,l)&&r(n,f)&&t.push(f)}return t},c.Q=function(n,e){var t=[];return[new a(-1,0),new a(1,0),new a(0,-1),new a(0,1),new a(-1,-1),new a(-1,1),new a(1,-1),new a(1,1)].forEach(function(r){u(n,e,r,t)}),t},e.exports={computeAllMoves:function(n){for(var e=[],t=0;t<=64;t++){var r=n.board[t],o=new a(t);null!=r&&r.side===n.turn&&c[r.type](n,o).forEach(function(n){e.push({src:o.offset,dst:n.offset})})}return e},pieceDestinationsEvaluator:c}},{"./coordinates":15}],19:[function(n,e,t){"use strict";function r(n,e,t){for(var r=null,o=0;o<64;o++){var i=n.board[o];if(null!=i&&i.type===e&&i.side===t){r=o;break}}return r}var o=n("./coordinates"),i=n("./updates"),u=n("./moves-pieces"),a=o.BoardCoordinates;e.exports={getAvailableMoves:function(n,e){if(1!=e){var t=0;if(n.board.forEach(function(n){null!=n&&(t+=1)}),2==t)return[]}var o=[],c=function(e,t,o){var a=i.applyMove(n,e),c=u.computeAllMoves(a),s=r(a,t,o),l=!1;return c.forEach(function(n){n.dst==s&&(l=!0)}),l};return u.computeAllMoves(n).forEach(function(e){var t=new a(e.src),r=new a(e.dst).sub(t),i=c(e,"K",n.turn);"K"==n.board[e.src].type&&2==r.x&&(i=i||n.check||c({src:e.src,dst:e.src+1},"K",n.turn)),"K"==n.board[e.src].type&&-2==r.x&&(i=i||n.check||c({src:e.src,dst:e.src-1},"K",n.turn)),i||o.push(e)}),o},isCurrentPlayerInCheck:function(n){var e=!1,t=n.turn;n.turn="W"===t?"B":"W";for(var r=0;r<=64;r++){var o=n.board[r],i=new a(r);null!=o&&o.side===n.turn&&u.pieceDestinationsEvaluator[o.type](n,i).forEach(function(t){var r=n.board[t.offset];r&&"K"===r.type&&r.side!==n.turn&&(e=!0)})}return n.turn=t,e}}},{"./coordinates":15,"./moves-pieces":18,"./updates":25}],20:[function(n,e,t){"use strict";function r(n){var e="";return e+=String.fromCharCode("a".charCodeAt(0)+n%8),e+=String.fromCharCode("1".charCodeAt(0)+Math.floor(n/8))}var o=n("./moves"),i=n("./updates"),u=n("./pgnParser"),a={"O-O":{W:{src:4,dst:6},B:{src:60,dst:62}},"O-O-O":{W:{src:4,dst:2},B:{src:60,dst:58}}};e.exports={pgnToMove:function(n,e){var t=null,r=a[e];if(r)t=r[n.turn];else{var i=u.parsePgnMove(e);i&&(o.getAvailableMoves(n).forEach(function(e){null!=i.srcCol&&e.src%8!=i.srcCol||null!=i.srcRow&&Math.floor(e.src/8)!=i.srcRow||e.dst==i.dst&&n.board[e.src].type==i.type&&(i.src=e.src)}),null!=i.src&&null!=i.dst&&(t={src:i.src,dst:i.dst},i.promotion&&(t.promotionType=i.promotion)))}return t},moveToPgn:function(n,e){var t="",u=n.board[e.src];if("P"!=u.type&&(t+=u.type),"K"===u.type&&e.dst-e.src==2)return"O-O";if("K"===u.type&&e.dst-e.src==-2)return"O-O-O";var a=[];o.getAvailableMoves(n).forEach(function(t){t.dst==e.dst&&u.type==n.board[t.src].type&&a.push(t.src)});var c=r(e.src);if(a.length>1){var s=0,l=0;a.forEach(function(n){var e=r(n);c[0]==e[0]&&(s+=1),c[1]==e[1]&&(l+=1)}),t+=1==s?c[0]:1==l?c[1]:c}var f=e.dst%8-e.src%8;(null!=n.board[e.dst]||"P"==u.type&&0!=f)&&(""==t&&"P"==u.type&&(t+=c[0]),t+="x"),t+=r(e.dst);var p=i.applyMove(n,e);return"P"==u.type&&(e.dst<8||e.dst>56)&&(t+="="+(e.promotionType?e.promotionType:"Q")),o.isCurrentPlayerInCheck(p)&&(0==o.getAvailableMoves(p).length?t+="#":t+="+"),t}}},{"./moves":19,"./pgnParser":21,"./updates":25}],21:[function(n,e,t){"use strict";function r(n,e){var t=null,r=n.charCodeAt(e)-o,u=n.charCodeAt(e+1)-i;return r>=0&&r<8&&u>=0&&u<8&&(t+=r,t+=8*u),t}var o="a".charCodeAt(0),i="1".charCodeAt(0);e.exports={parsePgnMove:function(n){var e={type:null,srcCol:null,srcRow:null,dst:null,promotion:null,capture:!1,checking:!1,mate:!1},t=0,u=n.length;-1!=["P","R","N","B","K","Q"].indexOf(n[t])?(e.type=n[t],t++):e.type="P";var a=n.indexOf("+"),c=n.indexOf("#"),s=n.indexOf("=");s>=0&&(e.promotion=n.substring(s+1,s+2),u=Math.min(s,u)),a>=0&&(e.checking=!0,u=Math.min(a,u)),c>=0&&(e.mate=!0,u=Math.min(c,u));var l=r(n,u-2);if(null==l)return null;e.dst=l,"x"===n[(u-=2)-1]&&(u-=1,e.capture=!0);for(var f=t;f<u;f++){var p=n.charCodeAt(t),h=p-i,d=p-o;h>=0&&h<8&&(e.srcRow=h),d>=0&&d<8&&(e.srcCol=d)}return e}}},{}],22:[function(n,e,t){"use strict";var r={PW:"â™™",PB:"â™Ÿ",NW:"â™˜",NB:"â™ž",BW:"â™—",BB:"â™",RW:"â™–",RB:"â™œ",QW:"â™•",QB:"â™›",KW:"â™”",KB:"â™š"};e.exports={pieceFactory:function(n,e){return{type:n,side:e}},pieceToUTF8:function(n){return r[n.type.concat(n.side)]}}},{}],23:[function(n,e,t){"use strict";function r(n,e,t,r){return(n+e)%2==0?"W"===t?r.WB:r.BB:"W"===t?r.WW:r.BW}var o=n("./piece");n("colors").setTheme({BW:["black","bgWhite"],BB:["black","bgMagenta"],WW:["white","bgWhite"],WB:["white","bgMagenta"]});var i=n("underscore-plus");e.exports={getInitialPosition:function(){return{turn:"W",castlingFlags:{W:{K:!0,Q:!0},B:{K:!0,Q:!0}},lastPawnMoveColumn:null,check:!1,fullMoveNumber:1,halfMoveClock:0,board:[o.pieceFactory("R","W"),o.pieceFactory("N","W"),o.pieceFactory("B","W"),o.pieceFactory("Q","W"),o.pieceFactory("K","W"),o.pieceFactory("B","W"),o.pieceFactory("N","W"),o.pieceFactory("R","W"),o.pieceFactory("P","W"),o.pieceFactory("P","W"),o.pieceFactory("P","W"),o.pieceFactory("P","W"),o.pieceFactory("P","W"),o.pieceFactory("P","W"),o.pieceFactory("P","W"),o.pieceFactory("P","W"),null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,o.pieceFactory("P","B"),o.pieceFactory("P","B"),o.pieceFactory("P","B"),o.pieceFactory("P","B"),o.pieceFactory("P","B"),o.pieceFactory("P","B"),o.pieceFactory("P","B"),o.pieceFactory("P","B"),o.pieceFactory("R","B"),o.pieceFactory("N","B"),o.pieceFactory("B","B"),o.pieceFactory("Q","B"),o.pieceFactory("K","B"),o.pieceFactory("B","B"),o.pieceFactory("N","B"),o.pieceFactory("R","B")]}},positionToString:function(n,e){var t=[];t.push("W"==n.turn?"WHITE":"BLACK"),t.push(" "),t.push(n.castlingFlags.W.K?"K":""),t.push(n.castlingFlags.W.Q?"Q":""),t.push(n.castlingFlags.B.K?"k":""),t.push(n.castlingFlags.B.Q?"q":"");var i,u;for(i=7;i>=0;i--)for(t.push("\n"),t.push(i+1),t.push(" "),u=0;u<8;u++){var a=n.board[8*i+u];e?null==a?t.push(r(i,u,"W","  ")):t.push(r(i,u,a.side,o.pieceToUTF8(a)+" ")):null==a?t.push(". "):"W"==a.side?t.push(a.type.toUpperCase()+" "):t.push(a.type.toLowerCase()+" ")}return t.push("\n  a b c d e f g h "),t.join("")},clone:function(n){return i.deepClone(n)}}},{"./piece":22,colors:5,"underscore-plus":13}],24:[function(n,e,t){"use strict";var r=n("./moves");e.exports={getGameStatus:function(n){var e="OPEN";return 0==r.getAvailableMoves(n).length&&(e=n.check?"W"==n.turn?"BLACKWON":"WHITEWON":"PAT"),e}}},{"./moves":19}],25:[function(n,e,t){"use strict";function r(n,e){var t=[],r=new c(e.src),i=new c(e.dst),u=i.sub(r),s=n.board[e.dst];if(null!=s&&t.push({action:"remove",src:e.dst}),t.push({action:"move",src:e.src,dst:e.dst}),null==s&&"P"==n.board[e.src].type&&Math.abs(u.x)){var l=r.add(new c(u.x,0));t.push({action:"remove",src:l.offset})}if("P"==n.board[e.src].type&&2==Math.abs(u.y)?t.push({action:"pawnColumn",col:e.src%8}):t.push({action:"pawnColumn",col:null}),"P"==n.board[e.src].type&&(0==i.y||7==i.y)){var f=e.promotionType?e.promotionType:"Q";t.push({action:"promote",src:e.dst,promotionType:f})}"K"==n.board[e.src].type&&(t.push({action:"resetCastling",sides:["K","Q"]}),4==r.x&&6==i.x&&t.push({action:"move",src:i.add(new c(1,0)).offset,dst:i.add(new c(-1,0)).offset}),4==r.x&&2==i.x&&t.push({action:"move",src:i.add(new c(-2,0)).offset,dst:i.add(new c(1,0)).offset})),"R"==n.board[e.src].type&&0==r.x&&t.push({action:"resetCastling",sides:["Q"]}),"R"==n.board[e.src].type&&7==r.x&&t.push({action:"resetCastling",sides:["K"]});var p=o(n,t);p.turn=n.turn;var h=!1;return a.computeAllMoves(p).forEach(function(e){var t=n.board[e.dst];t&&"K"==t.type&&t.side!=n.turn&&(h=!0)}),t.push({action:"updateCheckFlag",value:h}),"B"==n.turn&&t.push({action:"increaseMovesCounter"}),null!=s||"P"==n.board[e.src].type?t.push({action:"resetHalfMoveClock"}):t.push({action:"increaseHalfMoveClock"}),t}function o(n,e){var t=i.clone(n);return e.forEach(function(e){if("remove"===e.action){var r=e.src;t.board[r]=null}else"move"===e.action?(t.board[e.dst]=t.board[e.src],t.board[e.src]=null):"pawnColumn"===e.action?t.lastPawnMoveColumn=e.col:"resetCastling"===e.action?e.sides.forEach(function(e){t.castlingFlags[n.turn][e]=!1}):"updateCheckFlag"===e.action?t.check=e.value:"promote"===e.action?t.board[e.src].type=e.promotionType:"increaseMovesCounter"===e.action?t.fullMoveNumber+=1:"resetHalfMoveClock"===e.action?t.halfMoveClock=0:"increaseHalfMoveClock"===e.action&&(t.halfMoveClock+=1)}),t.turn="W"===n.turn?"B":"W",t}var i=n("./position"),u=n("./coordinates"),a=n("./moves-pieces"),c=u.BoardCoordinates;e.exports={computeDiffs:r,applyDiffs:o,applyMove:function(n,e){return o(n,r(n,e))}}},{"./coordinates":15,"./moves-pieces":18,"./position":23}],26:[function(n,e,t){"use strict";var r=n("./chess/position"),o=n("./chess/moves"),i=n("./chess/updates"),u=n("./chess/pgn"),a=n("./chess/fen"),c=n("./chess/status"),s=n("./chess/locator"),l={getInitialPosition:r.getInitialPosition,positionToString:r.positionToString,getAvailableMoves:o.getAvailableMoves,applyMove:i.applyMove,computeDiffs:i.computeDiffs,applyDiffs:i.applyDiffs,pgnToMove:u.pgnToMove,moveToPgn:u.moveToPgn,getGameStatus:c.getGameStatus,findPiece:s.findPiece,positionToFen:a.positionToFen,fenToPosition:a.fenToPosition};e.exports=l},{"./chess/fen":16,"./chess/locator":17,"./chess/moves":19,"./chess/pgn":20,"./chess/position":23,"./chess/status":24,"./chess/updates":25}]},{},[26])(26)});